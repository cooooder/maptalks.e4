/*!
 * maptalks.e4 v1.0.0
 * LICENSE : ISC
 * (c) 2016-2018 maptalks.org
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("maptalks"),require("echarts"),require("echarts-gl")):"function"==typeof define&&define.amd?define(["exports","maptalks","echarts","echarts-gl"],e):e(t.maptalks=t.maptalks||{},t.maptalks,t.echarts,t.echartsGl)}(this,function(t,e,n,o){"use strict";function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):function(t,e){for(var n=Object.getOwnPropertyNames(e),o=0;o<n.length;o++){var i=n[o],r=Object.getOwnPropertyDescriptor(e,i);r&&r.configurable&&void 0===t[i]&&Object.defineProperty(t,i,r)}}(t,e))}var s=function(t){function e(n,o,r){i(this,e);var s=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,t.call(this,n,r));return s._ecOptions=o,s}return r(e,t),e.prototype.getEChartsOption=function(){return this._ecOptions},e.prototype.setEChartsOption=function(t){return this._ecOptions=t,this._getRenderer()&&this._getRenderer()._clearAndRedraw(),this},e.prototype.toJSON=function(){return{type:this.getJSONType(),id:this.getId(),ecOptions:this._ecOptions,options:this.config()}},e.fromJSON=function(t){return t&&"E3Layer"===t.type?new e(t.id,t.ecOptions,t.options):null},e}(e.Layer);s.mergeOptions({container:"front",renderer:"dom",hideOnZooming:!1,hideOnMoving:!1,hideOnRotating:!1}),s.registerJSONType("E4Layer"),s.registerRenderer("dom",function(){function t(e){i(this,t),this.layer=e}return t.prototype.render=function(){this._container||this._createLayerContainer(),this._ec?this._isVisible()&&this._ec.resize():(this._ec=n.init(this._container),this._prepareECharts(),this._ec.setOption(this.layer._ecOptions,!1),this._ecMaptalks=this._ec.getModel().getComponent("maptalks3D").getMaptalks()),this.layer.fire("layerload")},t.prototype.drawOnInteracting=function(){this._isVisible()&&this._clearAndRedraw()},t.prototype.needToRedraw=function(){var t=this.getMap(),e=t._getRenderer();return t.isInteracting()||e&&(e.isStateChanged&&e.isStateChanged()||e.isViewChanged&&e.isViewChanged())},t.prototype.getMap=function(){return this.layer.getMap()},t.prototype._isVisible=function(){return this._container&&""===this._container.style.display},t.prototype.show=function(){this._container&&(this._container.style.display="")},t.prototype.hide=function(){this._container&&(this._container.style.display="none")},t.prototype.remove=function(){this._ec.clear(),this._ec.dispose(),delete this._ec,this._removeLayerContainer()},t.prototype.clear=function(){this._ec.clear()},t.prototype.setZIndex=function(t){this._zIndex=t,this._container&&(this._container.style.zIndex=t)},t.prototype.isCanvasRender=function(){return!1},t.prototype._prepareECharts=function(){var t=this.layer._ecOptions,e=this.getMap(),n=e.getCenter(),o=e.getZoom(),i=e.getPitch(),r=e.getBearing();t.maptalks3D.center=[n.x,n.y],t.maptalks3D.zoom=o,t.maptalks3D.pitch=i,t.maptalks3D.bearing=r;var s=this.layer._ecOptions.series;if(s)for(var a=s.length-1;a>=0;a--)s[a].coordinateSystem="maptalks3D",s[a].animation=!1},t.prototype._createLayerContainer=function(){var t=this._container=e.DomUtil.createEl("div");t.style.cssText="position:absolute;left:0px;top:0px;",this._zIndex&&(t.style.zIndex=this._zIndex),this._resetContainer(),("front"===this.layer.options.container?this.getMap()._panels.frontStatic:this.getMap()._panels.backStatic).appendChild(t)},t.prototype._removeLayerContainer=function(){this._container&&e.DomUtil.removeDomNode(this._container),delete this._levelContainers},t.prototype._resetContainer=function(){var t=this.getMap().getSize();this._container.style.width=t.width+"px",this._container.style.height=t.height+"px"},t.prototype.getEvents=function(){return{_zoomstart:this.onZoomStart,_zoomend:this.onZoomEnd,_dragrotatestart:this.onDragRotateStart,_dragrotateend:this.onDragRotateEnd,_movestart:this.onMoveStart,_moveend:this.onMoveEnd,_resize:this._resetContainer}},t.prototype._clearAndRedraw=function(){if(!this._container||"none"!==this._container.style.display){var t=this.getMap(),e=t.getCenter(),n=t.getZoom(),o=t.getPitch(),i=t.getBearing(),r=this._ecMaptalks;r.setCenter([e.x,e.y]),r.setZoom(n),r.setPitch(o),r.setBearing(i)}},t.prototype.onZoomStart=function(){this.layer.options.hideOnZooming&&this.hide()},t.prototype.onZoomEnd=function(){this.layer.options.hideOnZooming&&(this.show(),this._clearAndRedraw())},t.prototype.onDragRotateStart=function(){this.layer.options.hideOnRotating&&this.hide()},t.prototype.onDragRotateEnd=function(){this.layer.options.hideOnRotating&&(this.show(),this._clearAndRedraw())},t.prototype.onMoveStart=function(){this.layer.options.hideOnMoving&&this.hide()},t.prototype.onMoveEnd=function(){this.layer.options.hideOnMoving&&(this.show(),this._clearAndRedraw())},t}()),t.E4Layer=s,Object.defineProperty(t,"__esModule",{value:!0}),"undefined"!=typeof console&&console.log("maptalks.e4 v1.0.0")});